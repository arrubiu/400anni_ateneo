id: studenti
migration_tags:
  - CSV
label: 'CSV file migration'
source:
  plugin: csv
  path: /var/www/html/web/modules/custom/migrando/files/studenti.csv
  ids:
    concatena: # @TODO: verificare il campo CSV per il matching
      type: string

process:
  status:
    plugin: default_value
    default_value: 1 # Imposto il nodo come pubblico

  uid:
    plugin: default_value
    default_value: 5 # le persone/studenti le tratta Valeria, giusto?

  # Studente - Primo cognome et cetc
  title:
    plugin: concat
      source:
        - primo_cognome # @TODO: immettere il campo nel csv
        - secondo_cognome # @TODO: immettere il campo nel csv
        - primo nome # @TODO: immettere il campo nel csv
        - secondo nome # @TODO: immettere il campo nel csv
        - terzo nome nome # @TODO: immettere il campo nel csv
      delimiter: " " # Delimito ogni elemento del titolo con uno spazio

  ## Campi in comune con la persona

  field_id: concatena # @TODO: immettere il campo nel csv

  field_data_nascita: data_nascita # @TODO: immettere il campo nel csv

  field_luogo_nascita: # @TODO: dovrebbe essere un address (configurato con geofield&geocoder
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_primo_cognome:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_secondo_cognome:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_primo_nome:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_secondo_nome:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_terzo_nome:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_sesso:
    plugin: static_map  # Mappa tra valore sull'excel: "M" => "m"
      source: # @TODO: immettere il campo nel csv
      map:
        M: m
        F: f
        m: m
        f: f

  ## Campi specifici della carriera studente
  field_anno_immatricolazione:
    plugin: encode
    source: nome

  field_carriera: # @TODO lungo
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_corso: # @TODO: campo multiplo
    plugin: explode
    source: nome # @TODO: immettere il campo nel csv
    delimiter: ,
    process:
      target_id:
        plugin: migration_lookup
        migration: corso # @TODO: verificare nome import facoltà
        no_stub: true
        source: tid # @TODO: cosa mappare qui?

  field_data_laurea:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_data_licenza:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_facolta:
    plugin: explode
    source: nome # @TODO: immettere il campo nel csv
    delimiter: ,
    process:
      target_id:
        plugin: migration_lookup
        migration: facolta # @TODO: verificare nome import facoltà
        no_stub: true
        source: tid # @TODO: cosa mappare qui?

  field_revisore:
    plugin: default_value
    default_vaulue: 5 # il revisore è Valeria, giusto? @TODO aggiungere UID prof

  field_segnatura_arch_tesi_laurea:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_segnatura_arch_tesi_licenz:
    plugin: encode
    source: nome # @TODO: immettere il campo nel csv

  field_titolo_tesi_laurea: nome # @TODO: immettere il campo nel csv

  field_titolo_tesi_licenza: nome # @TODO: immettere il campo nel csv

  field_valutazione_laurea: nome # @TODO: immettere il campo nel csv

destination:
  plugin: 'entity:node'
  bundle: carriera_studente

migration_dependencies:
  required: {  }
  optional: {  }
